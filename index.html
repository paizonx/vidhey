<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="robots" content="index, follow">
<meta name="description" content="Watch trending viral videos daily.">
<meta name="theme-color" content="#0f0f0f">

<link rel="manifest" href="manifest.json">

<title>Viral Video - Trending Today</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">

<style>
/* --- THEME VARIABLES --- */
:root {
  --bg-main: #0f0f0f;
  --bg-card: #1f1f1f;
  --text-main: #ffffff;
  --accent: #ff0000;
  --header-h: 60px;
}

* { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
body { margin: 0; background-color: var(--bg-main); color: var(--text-main); font-family: 'Roboto', sans-serif; overflow-x: hidden; }
a { text-decoration: none; color: inherit; }

/* --- HEADER --- */
.header {
  position: fixed; top: 0; left: 0; right: 0; height: var(--header-h);
  background: rgba(15, 15, 15, 0.95); backdrop-filter: blur(10px);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 16px; z-index: 100; border-bottom: 1px solid #333;
}
.logo { font-weight: 900; font-size: 20px; display: flex; align-items: center; gap: 5px; cursor: pointer; }
.logo span { color: var(--accent); }

/* Tombol Install (Default Hidden, muncul via JS) */
.install-btn {
  background: #3ea6ff; color: #000; padding: 6px 14px; border-radius: 20px; 
  font-weight: 600; font-size: 13px; cursor: pointer; display: none; align-items: center; gap: 5px;
}
.install-btn.visible { display: flex; }

/* --- GRID GALLERY (PORTRAIT) --- */
.container { 
  max-width: 1400px; margin: 0 auto; 
  padding: calc(var(--header-h) + 15px) 15px 40px 15px; 
}

/* TABS / PILLS */
.filter-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; }
.pill { background: #272727; padding: 8px 16px; border-radius: 8px; font-size: 14px; white-space: nowrap; cursor: pointer; border: 1px solid #333; transition: 0.2s; }
.pill:hover { background: #3f3f3f; }
.pill.active { background: #f1f1f1; color: black; border-color: white; font-weight: 600; }

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 12px; row-gap: 24px;
}

.card { cursor: pointer; position: relative; transition: transform 0.2s; animation: fadeIn 0.5s ease; }
.card:hover { transform: translateY(-4px); }

@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

.poster {
  width: 100%; aspect-ratio: 9/14; /* Portrait Ratio */
  background: #1a1a1a; border-radius: 10px; overflow: hidden;
  position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}

/* THUMBNAIL VIDEO (Lazy Load) */
.thumb-media { 
  width: 100%; height: 100%; 
  object-fit: cover; 
  display: block; opacity: 0; transition: opacity 0.5s;
}
.thumb-media.loaded { opacity: 1; }

.views-pill {
  position: absolute; bottom: 8px; left: 8px;
  background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
  color: white; padding: 2px 6px; border-radius: 4px;
  font-size: 11px; font-weight: 600; display: flex; align-items: center; gap: 4px;
}
.hd-tag {
  position: absolute; top: 8px; right: 8px;
  background: rgba(0,0,0,0.6); color: white;
  padding: 2px 5px; border-radius: 3px;
  font-size: 10px; font-weight: bold; border: 1px solid rgba(255,255,255,0.3);
}

.meta { margin-top: 10px; padding: 0 2px; }
.title { font-size: 14px; font-weight: 500; line-height: 1.3; color: #eee; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.date { font-size: 12px; color: #888; margin-top: 4px; text-transform: capitalize; }

/* --- PLAYER PAGE --- */
#playerPage { display: none; padding-top: var(--header-h); }
.p-container { max-width: 1000px; margin: 0 auto; padding: 20px; }

.vid-box { 
  width: 100%; aspect-ratio: 16/9; background: #000; 
  border-radius: 12px; overflow: hidden; position: relative; 
  box-shadow: 0 10px 40px rgba(0,0,0,0.6); 
}
.vid-box.vertical { aspect-ratio: 9/16; max-width: 400px; margin: 0 auto; }

/* Money Maker Overlay */
.overlay {
  position: absolute; inset: 0; z-index: 50;
  background: rgba(0,0,0,0.4); cursor: pointer;
  display: flex; align-items: center; justify-content: center;
}
.play-icon {
  width: 70px; height: 70px; background: rgba(255,0,0,0.9); border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 0 20px rgba(255,0,0,0.5);
}

video, iframe { width: 100%; height: 100%; border: none; }
.hidden { display: none !important; }

.p-info { margin-top: 20px; }
.p-title { font-size: 20px; font-weight: 700; margin-bottom: 10px; }
.p-actions { display: flex; gap: 10px; margin-top: 15px; border-bottom: 1px solid #333; padding-bottom: 20px; }
.btn { flex: 1; padding: 12px; border-radius: 30px; border: none; font-weight: 600; cursor: pointer; font-size: 14px; }
.btn-dl { background: white; color: black; }
.btn-share { background: #333; color: white; }

.ad-slot { margin: 20px 0; background: #050505; border: 1px dashed #333; border-radius: 8px; min-height: 100px; display: flex; align-items: center; justify-content: center; }

@media (max-width: 768px) {
  .grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
}
</style>
</head>
<body oncontextmenu="return false;">

<div class="header">
  <div class="logo" onclick="window.location.href=window.location.pathname">
    Viral<span>Video</span>
  </div>
  <div class="install-btn" id="installAppBtn">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
    Install App
  </div>
</div>

<div class="container" id="galleryPage">
  <div class="filter-scroll">
    <div class="pill active" onclick="loadCategory('videos.txt', this)">Trending Today</div>
    <div class="pill" onclick="loadCategory('usa.txt', this)">Hot USA</div>
    <div class="pill" onclick="loadCategory('tiktok.txt', this)">Viral TikTok</div>
  </div>

  <div id="statusMsg" style="text-align:center; padding:40px; color:#666;">Loading viral content...</div>
  <div class="grid" id="gridTarget"></div>
</div>

<div id="playerPage">
  <div class="p-container">
    <div onclick="window.location.href=window.location.pathname" style="cursor:pointer; color:#aaa; font-size:14px; margin-bottom:15px;">&larr; Back to Feed</div>
    
    <div class="vid-box" id="shell">
      <div class="overlay" id="fakeOverlay" onclick="handleAdClick()">
        <div class="play-icon">
           <svg width="35" height="35" viewBox="0 0 24 24" fill="white"><path d="M8 5v14l11-7z"/></svg>
        </div>
      </div>
      <video id="vid" controls playsinline class="hidden"></video>
      <iframe id="frame" allow="autoplay; fullscreen" allowfullscreen class="hidden"></iframe>
    </div>

    <div class="p-info">
      <h1 class="p-title" id="vidTitle">Loading...</h1>
      <div style="font-size:13px; color:#aaa;">2.4M Views â€¢ Trending in United States</div>

      <div class="ad-slot">
         <div id="container-8754c34f20e587c8ef08a064d9f71e59"></div>
      </div>

      <div class="p-actions">
        <button class="btn btn-dl" id="dlBtn">Download HD</button>
        <button class="btn btn-share" onclick="window.open(ADS_LINK)">Share</button>
      </div>
    </div>
  </div>
</div>

<div id="histats_counter" style="display:none;"></div>

<script>
/* --- CONFIG --- */
const ADS_LINK = "https://ridernoodleacerbity.com/pu4v8n14t?key=280fea026bf240b90dd4b3343468c40f"; 
const HISTATS_ID = "4879497";

const q = new URLSearchParams(location.search);
const vidId = q.get('id');

/* --- SECURITY --- */
document.addEventListener('keydown', e => {
  if (e.ctrlKey && (e.key === 'u' || e.key === 'U')) e.preventDefault();
  if (e.key === 'F12') e.preventDefault();
});

/* --- INIT --- */
if(vidId) {
  document.getElementById('galleryPage').style.display = 'none';
  document.getElementById('playerPage').style.display = 'block';
  setupPlayer();
  injectAds();
} else {
  // LOAD DEFAULT (Trending)
  loadCategory('videos.txt', document.querySelector('.pill.active'));
}

/* --- LOGIC: PWA INSTALLATION --- */
let deferredPrompt;
const installBtn = document.getElementById('installAppBtn');

window.addEventListener('beforeinstallprompt', (e) => {
  // Mencegah browser langsung menampilkan prompt default
  e.preventDefault();
  deferredPrompt = e;
  // Munculkan tombol Install kita
  installBtn.classList.add('visible');
});

installBtn.addEventListener('click', async () => {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    deferredPrompt = null;
    // Sembunyikan tombol jika user menerima
    if (outcome === 'accepted') {
        installBtn.classList.remove('visible');
    }
  } else {
    // Fallback jika PWA tidak support (misal iOS)
    alert("To install: Tap 'Share' -> 'Add to Home Screen'");
  }
});

/* --- LOGIC: CLICK TO AD --- */
function handleAdClick() {
  window.open(ADS_LINK, '_blank');
  document.getElementById('fakeOverlay').style.display = 'none';
  const vid = document.getElementById('vid');
  const frame = document.getElementById('frame');
  
  if(!vid.classList.contains('hidden')) {
     vid.muted = false; vid.play();
  } else if(!frame.classList.contains('hidden')) {
     frame.src = frame.src; 
  }
}

/* --- LOGIC: LOAD CATEGORY DARI FILE TXT BERBEDA --- */
async function loadCategory(filename, btnElement) {
  const statusMsg = document.getElementById('statusMsg');
  const grid = document.getElementById('gridTarget');

  // 1. Update Tampilan Tab
  if(btnElement) {
    document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
    btnElement.classList.add('active');
  }

  // 2. Reset Grid & Show Loading
  grid.innerHTML = '';
  statusMsg.style.display = 'block';
  statusMsg.textContent = "Loading content from " + filename + "...";

  try {
    // 3. Fetch File .txt
    const res = await fetch(filename + '?t=' + Date.now());
    if(!res.ok) throw new Error("File " + filename + " not found.");
    const text = await res.text();
    const lines = text.split('\n');
    
    let html = '';
    let count = 0;

    lines.forEach(line => {
      if(line.trim().length < 3 || line.startsWith('[')) return;
      
      const parts = line.split('|');
      const id = parts[0].trim();
      const title = parts[1] ? parts[1].trim() : 'Viral Video';
      
      // Generate Fake Views
      const views = (Math.random() * (5 - 0.5) + 0.5).toFixed(1) + "M";

      // Render Video Thumbnail (Lazy Load)
      let mediaTag = '';
      if(id.length > 9 || id.startsWith('k')) {
         mediaTag = `<img src="https://www.dailymotion.com/thumbnail/video/${id}" class="thumb-media loaded">`;
      } else {
         mediaTag = `
           <video data-src="https://cdn.videy.co/${id}.mp4#t=0.1" 
                  class="thumb-media lazy" 
                  muted playsinline preload="metadata"
                  onmouseover="this.play()" 
                  onmouseout="this.pause();this.currentTime=0;">
           </video>
         `;
      }

      html += `
        <div class="card" onclick="location.href='?id=${id}'">
          <div class="poster">
             ${mediaTag}
             <div class="hd-tag">HD</div>
             <div class="views-pill">
               <svg width="12" height="12" viewBox="0 0 24 24" fill="white"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
               ${views}
             </div>
          </div>
          <div class="meta">
            <div class="title">${title}</div>
            <div class="date">Trending</div>
          </div>
        </div>
      `;
      count++;
    });

    if(count === 0) {
      statusMsg.textContent = "No videos in this list yet.";
    } else {
      statusMsg.style.display = 'none';
      grid.innerHTML = html;
      observeVideos(); // Aktifkan Lazy Loading
    }

  } catch(e) {
    statusMsg.innerHTML = "Error: File <b>" + filename + "</b> belum diupload.";
    statusMsg.style.color = "red";
  }
}

/* --- LOGIC: LAZY LOAD --- */
function observeVideos() {
  const lazyVideos = document.querySelectorAll('video.lazy');
  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver((entries, obs) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const v = entry.target;
          v.src = v.dataset.src;
          v.classList.remove('lazy');
          v.classList.add('loaded');
          obs.unobserve(v);
        }
      });
    });
    lazyVideos.forEach(v => observer.observe(v));
  } else {
    lazyVideos.forEach(v => { v.src = v.dataset.src; v.classList.add('loaded'); });
  }
}

/* --- PLAYER SETUP --- */
function setupPlayer() {
  const vid = document.getElementById('vid');
  const frame = document.getElementById('frame');
  const shell = document.getElementById('shell');

  document.getElementById('dlBtn').onclick = () => window.open(ADS_LINK, '_blank');
  document.getElementById('vidTitle').textContent = "Please Wait...";

  if(vidId.length > 9 || vidId.startsWith('k')) {
     frame.classList.remove('hidden');
     checkDmRatio(vidId);
     frame.src = `https://www.dailymotion.com/embed/video/${vidId}?autoplay=1&mute=1&controls=0&ui-logo=0`;
  } else {
     vid.classList.remove('hidden');
     vid.src = `https://cdn.videy.co/${vidId}.mp4`;
     vid.muted = true;
     vid.load();
     vid.onloadedmetadata = function() {
        if(this.videoHeight > this.videoWidth) shell.classList.add('vertical');
     };
  }
}

async function checkDmRatio(id) {
  try {
     const r = await fetch(`https://www.dailymotion.com/services/oembed?url=https://www.dailymotion.com/video/${id}`);
     const d = await r.json();
     if(d.height > d.width) document.getElementById('shell').classList.add('vertical');
  } catch(e){}
}

/* --- ADS --- */
function injectAds() {
  const n = document.createElement('script');
  n.src = "https://ridernoodleacerbity.com/8754c34f20e587c8ef08a064d9f71e59/invoke.js";
  n.async = true; n.setAttribute('data-cfasync','false');
  document.head.appendChild(n);

  const p = document.createElement('script');
  p.src = "https://ridernoodleacerbity.com/c9/c0/46/c9c04611f8fb3b0b21da4b49fb98d3fa.js";
  document.body.appendChild(p);

  const h = document.createElement('script');
  h.text = `
    var _Hasync= _Hasync|| [];
    _Hasync.push(['Histats.start', '1,${HISTATS_ID},4,0,0,0,00010000']);
    _Hasync.push(['Histats.fasi', '1']);
    _Hasync.push(['Histats.track_hits', '']);
    (function() {
    var hs = document.createElement('script'); hs.type = 'text/javascript'; hs.async = true;
    hs.src = ('//s10.histats.com/js15_as.js');
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(hs);
    })();
  `;
  document.body.appendChild(h);
}
</script>
</body>
</html>
